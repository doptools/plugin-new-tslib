"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@angular-devkit/core");
const schematics_1 = require("@angular-devkit/schematics");
const versions_json_1 = __importDefault(require("../versions.json"));
const npm_package_arg_1 = __importDefault(require("npm-package-arg"));
const url_template_1 = __importDefault(require("url-template"));
function default_1(options) {
    var _a, _b, _c;
    let name = options.name;
    let scope = '';
    if (name.startsWith('@')) {
        const p = name.split('/', 2);
        scope = p[0].substring(1);
        name = core_1.strings.dasherize(p[1]);
    }
    let homepage = '';
    let bugs = '';
    let repository = '';
    if (options.repository) {
        if (options.repository.indexOf('github.com') !== -1) {
            const p = npm_package_arg_1.default(options.repository);
            const hosted = p.hosted;
            const info = {
                domain: (_a = p.hosted) === null || _a === void 0 ? void 0 : _a.domain,
                user: (_b = p.hosted) === null || _b === void 0 ? void 0 : _b.user,
                project: (_c = p.hosted) === null || _c === void 0 ? void 0 : _c.project
            };
            homepage = url_template_1.default.parse(hosted.bugstemplate).expand(info);
            bugs = url_template_1.default.parse(hosted.docstemplate).expand(info);
            repository = url_template_1.default.parse(hosted.browsetemplate).expand(info);
        }
    }
    const packageName = (scope ? `@${scope}/` : '') + name;
    return schematics_1.chain([
        schematics_1.mergeWith(schematics_1.apply(schematics_1.url("./files"), [
            schematics_1.template(Object.assign(Object.assign(Object.assign({}, core_1.strings), options), { packageName,
                name,
                scope,
                homepage,
                repository,
                bugs, dot: ".", versions: versions_json_1.default })),
            schematics_1.renameTemplateFiles()
        ]))
    ]);
}
exports.default = default_1;
//# sourceMappingURL=index.js.map